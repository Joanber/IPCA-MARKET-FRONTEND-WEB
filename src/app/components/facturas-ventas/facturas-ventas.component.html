<app-modal-factura [factura]="facturaModal"></app-modal-factura>
<div class="text-center">
  <h2 class="display-5">Venta de Productos</h2>
  <hr class="separador-pri w-100" />
</div>

<form #form="ngForm">
  <div class="row justify-content-center">
    <div class="col-sm-10">
      <label for="buscar" class="col-form-label mr-2 font-weight-bold"
        >Código del Producto:</label
      >
      <mat-form-field style="width: 400px !important">
        <input
          type="text"
          placeholder=""
          class="form-control mayusculas"
          matInput
          [formControl]="autocompleteControl"
          [matAutocomplete]="auto"
        />
        <mat-autocomplete
          #auto="matAutocomplete"
          [displayWith]="mostrarNombre"
          (optionSelected)="seleccionarProducto($event)"
        >
          <mat-option
            *ngFor="let producto of productosFiltrados | async"
            [value]="producto"
          >
            {{ producto.nombre }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>
  </div>

  <table class="table table-bordered table-responsive-md text-center">
    <thead class="bg-pri white">
      <tr>
        <th>Código de Barras</th>
        <th>Nombre</th>
        <th>Cantidad</th>
        <th>Precio</th>
        <th>Subtotal</th>
        <th>Existencia</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of factura.detalles_facturas">
        <td>{{ item.producto.codigo_barras }}</td>
        <td>{{ item.producto.nombre }}</td>

        <td>
          <div class="row justify-content-center">
            <input
              type="number"
              value="{{ item.cantidad }}"
              class="form-control col-sm-4"
              (change)="actualizarCantidad(item.producto.id, $event)"
            />
          </div>
        </td>

        <td>${{ item.producto.precio | number: ".2-2" }}</td>
        <td>${{ item.calcularImporte() | number: ".2-2" }}</td>
        <td>{{ item.calcularExistencia() }}</td>
        <td>
          <button
            class="btn bg-pri white btn-sm"
            type="button"
            (click)="eliminarItemFactura(item.producto.id)"
          >
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div
    class="text-center alert alert-info my-4"
    *ngIf="factura.detalles_facturas.length == 0"
  >
    AGREGUE PRODUCTOS A SU FACTURA, AL MENOS UNA !
  </div>
  <div class="row justify-content-end">
    <div class="col-3 text-center">
      <h1 style="color: blue">
        ${{ factura.calcularGranTotal() | number: ".2-2" }}
      </h1>
      <button
        class="btn bg-pri btn-block text-white float-right"
        type="button"
        (click)="abrirModal(this.factura, form)"
      >
        <i class="fas fa-cart-arrow-down mr-2"></i>Vender
      </button>
    </div>
  </div>
</form>
